!function(t){for(var e=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var n=Date.now(),r=Math.max(0,16-(n-e)),a=t.setTimeout(function(){i(n+r)},r);return e=n+r,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r})}(this);var cMove=function(){function t(t,e){var i=this;i.x=e.x||0,i.y=e.y||0,i.initX=e.x||0,i.initY=e.y||0,i.w=e.w||a.RECTANGLE_WIDTH,i.h=e.h||a.RECTANGLE_HEIGHT,i.fill=e.fill||null,i.stroke=e.stroke||null,i.strokeWidth=e.strokeWidth||a.RECTANGLE_STROKE_WIDTH,i.selectable=e.selectable!==!1,i.draggable=e.draggable!==!1,i.type=e.type||"rectangle",i.myCanvas=t}function e(t,e){if(!e.src)throw new TypeError("Src of picture is required.");var i=new Image,n=this,o=t.ratio;a.RETINA_PICTURES&&a.RETINA_X2_PATH&&o>1&&2>=o&&(e.src=r(e.src,a.RETINA_X2_PATH)),a.RETINA_PICTURES&&a.RETINA_X3_PATH&&o>2&&(e.src=r(e.src,a.RETINA_X3_PATH)),i.src=e.src,n.pic=i,n.src=e.src||"",n.x=e.x||0,n.y=e.y||0,n.initX=e.x||0,n.initY=e.y||0,n.w=e.w||0,n.h=e.h||0,n.selectable=e.selectable!==!1,n.draggable=e.draggable!==!1,n.type=e.type||"picture",n.myCanvas=t,i.onload=function(){(0===n.w||0===n.h)&&(a.RETINA_PICTURES&&a.RETINA_X2_PATH&&o>1&&2>=o?(n.w=n.pic.naturalWidth/2,n.h=n.pic.naturalHeight/2):a.RETINA_PICTURES&&a.RETINA_X3_PATH&&o>2?(n.w=n.pic.naturalWidth/3,n.h=n.pic.naturalHeight/3):(n.w=n.pic.naturalWidth,n.h=n.pic.naturalHeight)),t.valid=!1}}function i(t,e){function i(t){for(var e=s.getPointer(t),i=e.x,n=e.y,r=s.shapes,a=r.length,o=a-1;o>=0;o--)if(s.shapes[o].contains(i,n)){var c=s.shapes[o];return s.dragoffx=i-c.x,s.dragoffy=n-c.y,s.dragging=!0,s.selection=c,void(s.valid=!1)}s.selection&&(s.selection=null,s.valid=!1)}function r(t){if(s.dragging&&s.selection.draggable){t.preventDefault();var e=s.getPointer(t);s.selection.x=e.x-s.dragoffx,s.selection.y=e.y-s.dragoffy,a.STRONG_BORDERS&&(s.selection.x<0&&(s.selection.x=0),s.selection.y<0&&(s.selection.y=0),s.selection.x+s.selection.w>s.width&&(s.selection.x=s.width-s.selection.w),s.selection.y+s.selection.h>s.height&&(s.selection.y=s.height-s.selection.h)),s.valid=!1}}function o(){s.dragging=!1}var s=this;s.canvas=t,s.width=t.width,s.height=t.height,s.ctx=t.getContext("2d"),s.ratio=1,s.shapes=[],s.rectangles=[],s.pictures=[],s.dragging=!1,s.selection=null,s.dragoffx=0,s.dragoffy=0,s.ie=-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")||-1!=navigator.userAgent.toLowerCase().indexOf("windows nt")&&-1!=navigator.userAgent.toLowerCase().indexOf("touch");for(var c in e)e.hasOwnProperty(c)&&(s[c]=e[c]);var l=window.getComputedStyle(t,null);s.stylePaddingLeft=parseInt(l.paddingLeft,10)||0,s.stylePaddingTop=parseInt(l.paddingTop,10)||0,s.styleBorderLeft=parseInt(l.borderLeftWidth,10)||0,s.styleBorderTop=parseInt(l.borderTopWidth,10)||0,s.draw=n.bind(s),t.addEventListener("selectstart",function(t){return t.preventDefault(),!1},!1),t.addEventListener("pointerdown",i,!0),t.addEventListener("pointermove",r,!0),t.addEventListener("pointerup",o,!0),s.init(t),s.draw()}function n(){var t=this;if(!t.valid){var e=(t.ctx,t.shapes),i=e.length;t.clear();for(var n=0;i>n;n++){var r=e[n];r.x>t.width||r.y>t.height||r.x+r.w<0||r.y+r.h<0||e[n].draw()}t.selection&&a.SELECTION_ON_TOP&&t.selection.draw(),t.valid=!0}requestAnimationFrame(t.draw,t.canvas)}function r(t,e){var i=t.split("/");return i[i.length-1]=e+"/"+i[i.length-1],i.join("/")}var a={RECTANGLE_WIDTH:50,RECTANGLE_HEIGHT:50,RECTANGLE_STROKE_WIDTH:1,SHAPES_SELECTION:!0,SELECTION_COLOR:"#ffca4b",SELECTION_WIDTH:2,SELECTION_ON_TOP:!0,STRONG_BORDERS:!0,RETINA_PICTURES:!1,RETINA_X2_PATH:"x2",RETINA_X3_PATH:"x3"};return t.prototype.draw=function(){var t=this,e=t.myCanvas.ctx;t.fill&&(e.fillStyle=t.fill,e.fillRect(t.x,t.y,t.w,t.h)),a.SHAPES_SELECTION&&t.selectable&&t.myCanvas.selection===t?(e.strokeStyle=a.SELECTION_COLOR,e.lineWidth=a.SELECTION_WIDTH,e.strokeRect(t.x,t.y,t.w,t.h)):t.stroke&&(e.strokeStyle=t.stroke,e.lineWidth=t.strokeWidth,e.strokeRect(t.x,t.y,t.w,t.h))},t.prototype.contains=function(t,e){var i=this;return i.x<=t&&i.x+i.w>=t&&i.y<=e&&i.y+i.h>=e},e.prototype.draw=function(){var t=this,e=t.myCanvas.ctx;a.SHAPES_SELECTION&&t.selectable&&t.myCanvas.selection===t&&(e.strokeStyle=a.SELECTION_COLOR,e.lineWidth=a.SELECTION_WIDTH,e.strokeRect(t.x,t.y,t.w,t.h)),e.drawImage(t.pic,t.x,t.y,t.w,t.h)},e.prototype.contains=function(t,e){var i=this;return i.x<=t&&i.x+i.w>=t&&i.y<=e&&i.y+i.h>=e},i.prototype.addShape=function(t){var e=this;e.shapes.push(t),"rectangle"===t.type&&e.rectangles.push(t),"picture"===t.type&&e.pictures.push(t),e.valid=!1},i.prototype.clear=function(){var t=this;return t.ctx.clearRect(0,0,t.width,t.height),t},i.prototype.getPointer=function(t){var e,i,n=this,r=n.canvas,a=r.getBoundingClientRect(),o=a.top+n.styleBorderTop+n.stylePaddingTop,s=a.left+n.styleBorderLeft+n.stylePaddingLeft;return n.ie?(e=t.originalEvent.pageX-s,i=t.originalEvent.pageY-o):(e=t.clientX-s,i=t.clientY-o),{x:e,y:i}},i.prototype.init=function(t){var e=this,i=e.ctx,n=window.devicePixelRatio||1,r=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,a=n/r,o=t.parentNode,s=o.offsetWidth,c=o.offsetHeight;t.width=s,t.height=c,t.style.width=s+"px",t.style.height=c+"px",e.width=s,e.height=c,1!==a&&(e.ratio=a,s*=a,c*=a,t.width=s,t.height=c,e.ctx.scale(a,a))},{MyCanvas:i,Rectangle:t,Picture:e,config:a}}();